<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GK Study Centre â€“ Final System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase (GitHub compatible) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f4f7;margin:0}
header{background:#0a3d62;color:#fff;text-align:center;padding:15px}
nav{background:#34495e;text-align:center;padding:8px}
nav button{margin:4px;padding:8px 12px;border:0;border-radius:4px;background:#2c3e50;color:#fff}
section{display:none;padding:15px}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select,button{width:100%;padding:8px;margin:6px 0}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
img{max-width:120px;border-radius:50%;margin:10px 0}
</style>
</head>

<body>

<header>
<h2>GK Study Centre</h2>
<p>Admin | Student | Attendance | Fees | Firebase</p>
</header>

<nav>
<button onclick="show('login')">Login</button>
<button onclick="logout()">Logout</button>
</nav>

<!-- LOGIN -->
<section id="login" class="card">
<h3>Login</h3>
<select id="role">
<option value="admin">Admin</option>
<option value="student">Student</option>
</select>
<input id="lid" placeholder="ID (student id / admin)">
<input id="lpass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="msg"></p>
</section>

<!-- ADMIN PANEL -->
<section id="adminPanel" class="card">
<h3>Admin Panel</h3>

<h4>Change Admin Password</h4>
<input id="newAdminPass" type="password" placeholder="New Admin Password">
<button onclick="changeAdminPass()">Update Password</button>

<hr>

<h4>Add Student</h4>
<input id="sid" placeholder="Student ID">
<input id="sname" placeholder="Student Name">
<input id="sclass" placeholder="Class">
<input id="spass" placeholder="Student Password">
<input type="file" accept="image/*" onchange="uploadPhoto(event)">
<button onclick="addStudent()">Add Student</button>

<hr>

<h4>Attendance</h4>
<input type="date" id="adate">
<select id="astudent"></select>
<select id="astatus">
<option>Present</option>
<option>Absent</option>
</select>
<button onclick="saveAttendance()">Save Attendance</button>

<hr>

<h4>Fees</h4>
<select id="fstudent"></select>
<input id="ftotal" placeholder="Total Fees">
<input id="fpaid" placeholder="Paid Amount">
<button onclick="saveFees()">Save Fees</button>
</section>

<!-- STUDENT PANEL -->
<section id="studentPanel" class="card">
<h3>Student Dashboard</h3>

<img id="profileImg">
<p id="sinfo"></p>

<h4>Monthly Attendance</h4>
<input type="month" id="month">
<button onclick="loadAttendance()">View</button>
<p id="attPercent"></p>

<table>
<thead><tr><th>Date</th><th>Status</th></tr></thead>
<tbody id="attTable"></tbody>
</table>

<h4>Fees Summary</h4>
<div id="feeBox"></div>
<button onclick="window.print()">Download / Print PDF</button>
</section>

<script>
/* ðŸ”¥ YOUR FIREBASE CONFIG (ALREADY GITHUB READY) */
firebase.initializeApp({
  apiKey: "AIzaSyAuW-_QhchJ0wGQKJzYvqCQO8UL9CBJq4E",
  authDomain: "student-best-ai-teacher.firebaseapp.com",
  databaseURL: "https://student-best-ai-teacher-default-rtdb.firebaseio.com",
  projectId: "student-best-ai-teacher",
  storageBucket: "student-best-ai-teacher.appspot.com",
  messagingSenderId: "983601405082",
  appId: "1:983601405082:web:44aaa73bb73470c21f9323"
});
const db = firebase.database();

let currentStudent="", studentPhoto="";
const ADMIN_KEY="admin/password";

/* NAV */
function show(id){
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
}
show("login");

/* LOGIN */
function login(){
 let r=role.value,id=lid.value,p=lpass.value;
 if(r==="admin"){
  db.ref(ADMIN_KEY).once("value",s=>{
   if(s.val()===p){
    show("adminPanel");loadStudents();
   }else msg.innerText="Wrong Admin Password";
  });
 }else{
  db.ref("students/"+id).once("value",s=>{
   if(!s.exists()||s.val().password!==p){
    msg.innerText="Invalid Student Login";
   }else{
    currentStudent=id;
    sinfo.innerHTML=`<b>Name:</b> ${s.val().name}<br><b>Class:</b> ${s.val().class}`;
    profileImg.src=s.val().photo||"";
    loadFees();
    show("studentPanel");
   }
  });
 }
}

function logout(){show("login");}

/* ADMIN */
function changeAdminPass(){
 db.ref(ADMIN_KEY).set(newAdminPass.value);
 alert("Admin Password Updated");
}

function uploadPhoto(e){
 let r=new FileReader();
 r.onload=()=>studentPhoto=r.result;
 r.readAsDataURL(e.target.files[0]);
}

function addStudent(){
 db.ref("students/"+sid.value).set({
  name:sname.value,
  class:sclass.value,
  password:spass.value,
  photo:studentPhoto
 });
 alert("Student Added");
 loadStudents();
}

function loadStudents(){
 astudent.innerHTML="";fstudent.innerHTML="";
 db.ref("students").once("value",snap=>{
  snap.forEach(c=>{
   astudent.innerHTML+=`<option value="${c.key}">${c.val().name}</option>`;
   fstudent.innerHTML+=`<option value="${c.key}">${c.val().name}</option>`;
  });
 });
}

function saveAttendance(){
 db.ref("attendance/"+astudent.value+"/"+adate.value)
 .set(astatus.value);
 alert("Attendance Saved");
}

function saveFees(){
 db.ref("fees/"+fstudent.value).set({
  total:parseInt(ftotal.value),
  paid:parseInt(fpaid.value)
 });
 alert("Fees Updated");
}

/* STUDENT */
function loadAttendance(){
 let total=0,present=0;
 attTable.innerHTML="";
 let m=month.value;
 db.ref("attendance/"+currentStudent).once("value",s=>{
  s.forEach(d=>{
   if(d.key.startsWith(m)){
    total++;
    if(d.val()==="Present") present++;
    attTable.innerHTML+=`
    <tr><td>${d.key}</td><td>${d.val()}</td></tr>`;
   }
  });
  let percent= total? Math.round((present/total)*100):0;
  attPercent.innerHTML=`Attendance: ${percent}% (${present}/${total})`;
 });
}

function loadFees(){
 db.ref("fees/"+currentStudent).once("value",s=>{
  if(!s.exists()) return;
  let bal=s.val().total - s.val().paid;
  feeBox.innerHTML=`
   <b>Total:</b> â‚¹${s.val().total}<br>
   <b>Paid:</b> â‚¹${s.val().paid}<br>
   <b>Balance:</b> â‚¹${bal}
  `;
 });
}
</script>

</body>
</html>
